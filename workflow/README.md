# Workflow

This directory contains the code and workflow descriptions for reproducing the numerical results presented in the article.

---

## Simulation Results

The simulation results can be generated using the scripts in the `Simulation` folder by following these steps:

- **Table 1**  
  - Run `main_proposed.R` with `ext = FALSE`, `gamma_fix = FALSE`, and `gap = FALSE`.  
    - This will produce **Loss**, **Bloss**, and **MMSE** values reported in the table.  
    - The probability \( P(\hat{K} = K) \) can be calculated from the `ICstore` (information criterion) in the output.  
  - Run `proposed_FDRandVariance.R` using the `.RData` files generated by `main_proposed.R` to obtain **ECP**, **MMFDR**, and **MMFNR**.  
  - For the **LR** and **LRRI** results, run `main_LRandLRRI.R`.

- **Table S2**  
  - Run `test_constraint_parameter.R`. In the saved output object (out), the table values **Loss**, **Bloss** and **MMSE** correspond to **TotalLoss**, **Bloss** and   **MMSE**.
  - 
- **Table S3**  
  - Run `computational_time.R`. The computational times are saved in the object **sim_time**

- **Table S4**  
  - Run `main_proposed.R` with `ext = FALSE`, `gamma_fix = FALSE`, and `gap = TRUE`.  
  - Then run `proposed_LatentFDRandVariance.R` using the `.RData` files from `main_proposed.R`. The relevant outputs are saved in the resulting .RData file.

- **Table S5**  
  - Run `main_proposed.R` with the following settings:  
    - `ext = TRUE`,`gamma_fix = FALSE`  for Section 2.3.2  
    - `ext = FALSE`,`gamma_fix = TRUE` for Section 2.3.3
    - `ext = TRUE`,`gamma_fix = TRUE` for Section 2.3.2 and 2.3.3  
  - Ensure `gap = FALSE` for all runs.

---

## Real Data Analysis

The real data analysis can be reproduced using the scripts in the `Real Data Analysis` folder.  

To successfully run these codes, you will need to **download the raw data** and place it in a subfolder named `Complete journey`.  
The raw dataset is available from [Dunnhumby](https://www.dunnhumby.com/source-files).

Follow these steps to generate the tables:

- **Tables S6 and S7**  
  - Run `Estimation_real_data.R` with `ext = FALSE` and `gamma_fix = FALSE`.  
  - Then run `Inference_outcome.R` using the generated `.RData` files. The outputs for Tables S6 and S7 are stored in **product_data_size** and **product_data_income**, respectively.

- **Table 2 and Table S8**  
  - Run `Estimation_real_data.R` using all combinations of `ext` and `gamma_fix`.  
  - Run `Recommendation_performance.R` on the `.RData` files from these runs for different number of recommendations (10,20,30 and 40). The relevant output is stored in **sen_result**.

- **Table S9**  
  - Results are automatically produced by `Estimation_real_data.R` during the workflow for **Table 2 and Table S8**.

---
